# 智慧工地监控系统

## 项目简介
本项目是一个基于PyQt5和OpenCV开发的智慧工地监控系统，实现了视频播放、摄像头监控、云端安全帽检测等功能，适用于建筑工地的安全监控与管理。

## 功能特点
- 视频播放与暂停控制
- 实时摄像头监控（支持开启/关闭）
- 视频录制功能（自动按时间分段保存，每20秒一个片段）
- 云端安全检测（检测未佩戴安全帽等违规行为）
- 视频文件管理（实时监控列表与已检测视频列表展示、点击播放、删除）
- 检测结果可视化（违规目标标记与信息展示）

## 项目结构lesson16_gongdi/
├── main.py               # 程序入口，启动应用
├── hat.py                # 云端检测相关功能，调用API进行安全帽检测
├── view.py               # 早期界面布局代码（备用）
├── apig_sdk/             # 签名认证SDK，用于API请求签名
│   ├── __init__.py
│   └── signer.py         # 签名实现逻辑
├── views/                # 界面组件
│   ├── MainWidget.py     # 主窗口组件，包含整体布局和列表管理
│   ├── VideoWidget.py    # 视频播放组件，处理视频播放、摄像头控制等
│   └── README.md         # 视图模块说明
├── images/               # 图片资源
│   ├── background.jpg    # 背景图片
│   ├── img.jpg           # 示例图片
│   └── temp.jpg          # 临时图片（用于云端检测）
├── videos/               # 录制的视频文件（按时间戳命名）
├── check_videos/         # 检测后的视频文件
└── finish_videos/        # 处理完成的视频文件
## 环境依赖
- Python 3.7+
- PyQt5 (GUI框架，用于界面展示)
- OpenCV-Python (视频处理、图像操作)
- requests (网络请求，用于调用云端API)
- Pillow (图像处理支持，可选)

## 安装与运行
1. 安装依赖包：pip install pyqt5 opencv-python requests
2. 配置云端检测（可选）：
   - 若使用云端安全帽检测功能，需确保`hat.py`中的`ak`和`sk`有效（当前已配置测试密钥）
   - 确认API接口地址`url`可正常访问

3. 运行程序：python main.py
## 使用说明
1. **视频播放**：
   - 在右侧"工地实时监控列表"中选择视频文件
   - 点击"播放"按钮开始播放，"暂停"按钮停止播放

2. **摄像头监控**：
   - 点击"打开摄像头"按钮开启实时监控（自动切换至摄像头画面）
   - 系统会自动录制视频，每20秒生成一个片段保存至`videos`目录
   - 点击"关闭摄像头"按钮停止监控

3. **云端检测**：
   - 选择需要检测的视频文件（从实时监控列表中）
   - 点击"云检查"按钮进行安全检测（检测未佩戴安全帽等行为）
   - 检测结果视频保存至`check_videos`目录，并更新至"工地检测监控列表"

4. **查看检测结果**：
   - 在右侧"工地检测监控列表"中选择已检测的视频
   - 点击即可显示视频首帧，点击"播放"可查看完整检测过程（含违规标记）

## 注意事项
- 确保网络连接正常以使用云端检测功能
- 视频文件默认按时间戳命名，保存在对应目录中
- 摄像头开启时会自动录制，关闭时停止并保存
- 临时图片`temp.jpg`用于云端检测临时存储，请勿手动删除
- 若视频无法播放，可能是录制时间过短（不足20秒）或格式兼容问题

## 功能扩展建议
- 增加多摄像头切换与管理功能
- 实现违规行为实时报警（声音或弹窗提示）
- 添加视频回放速度控制、进度条拖动功能
- 增加用户权限管理与操作日志记录
- 实现历史检测数据统计与报表生成
- 优化云端检测效率，支持批量视频检测
